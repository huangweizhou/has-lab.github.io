---
layout: post
title: Batch-Aware Unified Memory Management in GPUs for Irregular Workloads
author: Weizhou Huang
tags:
 - ATC
 - 2020
 - Heterogeneous Systems
---

# [GAIA: An OS Page Cache for Heterogeneous Systems](https://www.usenix.org/system/files/atc19-brokhman.pdf)
本文为GPU提供了mmap（）功能，将文件映射到GPU地址空间。


## 背景和问题：

GPU内存完全由GPU驱动管理，而没有主机操作系统（host OS）的参与。因此GPU 无法使用mmap（）接口高效地访问内存映射的文件，也无法针对CPU和GPU共享文件进行IO优化。因此需要需要将GPU内存更紧密地集成到OS page cache和文件I/O机制中。

将文件映射到GPU内存能带了许多好处：实现系统级别的性能优化，如为GPU内核实现预取和双缓存；文件内存也可以被CPU和GPU共享；而将OS page cache延伸到GPU内存能够将大尺寸文件缓存到GPU 内存，相比通过CPU访问SS能提升IO性能；最后，允许OS管理GPU的page cache能够避免污染CPU page cache。

然而现有相关工作并没有阿静GPU内存和OS page cache高度整合：[ActivePointers](https://dl.acm.org/doi/10.1145/3007787.3001200)提供了一个mmaped file抽象，但是需要修改GPU内核，使它们与闭源库(如CuBLAS)不兼容；NVIDIA UVM和[Linux HMM](https://www.kernel.org/doc/html/v4.18/vm/numa.html)允许CPU和GPU 访问共享内存，但是不提供mmap功能，并且限制一个物理内存页只出现在一个处理器地址空间中。



## 设计：
本文提出GAIA，针对分布式多GPU架构的的弱一致性page cache。
### 设计目标：
- map for GPU kernels（主）
- efficient write-sharing between CPU and GPU
- enable CPU and GPU I/O optimaizations

### 主要挑战：
- CPU 和GPU共享文件造成的一致性问题
内存一致性模型

### insight： false sharing会使强内存一致性模型的性能下降严重，这是因为。。。，因此选择弱一致性模型。
